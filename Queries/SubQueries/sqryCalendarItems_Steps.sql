SELECT tblPartSteps.partNumber AS ID, "Step" AS type, tblPartSteps.partNumber, tblPartSteps.stepType AS [Action], IIf(IsNull([dueDate]),IIf(IsNull([soonestPillar]),IIf(IsNull([gateLastPillar]),[gatePlannedDate],[gateLastPillar]),[soonestPillar]),[duedate]) AS due, tblPartTeam.person
FROM (sqryPartProjectTags INNER JOIN ((tblPartGates INNER JOIN (((tblPartSteps LEFT JOIN tblPartInfo ON tblPartSteps.partNumber = tblPartInfo.partNumber) LEFT JOIN tblPartTeam ON tblPartSteps.partNumber = tblPartTeam.partNumber) LEFT JOIN tblPermissions ON tblPartSteps.responsible = tblPermissions.Dept) ON tblPartGates.recordId = tblPartSteps.partGateId) INNER JOIN qryPartTrackerFindStepDue ON tblPartGates.recordId = qryPartTrackerFindStepDue.gateID) ON sqryPartProjectTags.recordId = tblPartSteps.partProjectId) INNER JOIN qryFindNextPillar ON tblPartGates.recordId = qryFindNextPillar.partGateId
WHERE (((tblPartTeam.person)=[User]) AND ((tblPartSteps.status)<>'Closed') AND ((tblPartSteps.dueDate) Is Not Null) AND ((tblPartSteps.responsible) Is Not Null) AND ((tblPartSteps.indexOrder)<=[qryFindNextPillar].[index]))
GROUP BY "Step", tblPartSteps.partNumber, tblPartSteps.stepType, IIf(IsNull([dueDate]),IIf(IsNull([soonestPillar]),IIf(IsNull([gateLastPillar]),[gatePlannedDate],[gateLastPillar]),[soonestPillar]),[duedate]), tblPartTeam.person, tblPartSteps.partNumber, sqryPartProjectTags.partProjectStatus
HAVING (((sqryPartProjectTags.partProjectStatus)<>'On Hold'))
ORDER BY IIf(IsNull([dueDate]),IIf(IsNull([soonestPillar]),IIf(IsNull([gateLastPillar]),[gatePlannedDate],[gateLastPillar]),[soonestPillar]),[duedate]);

