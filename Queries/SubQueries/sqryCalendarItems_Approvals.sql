SELECT tblPartSteps.partnumber AS ID, "Step Approval" AS type, tblPartSteps.partNumber, "Approve: " & [tblPartSteps]![stepType] AS [Action], IIf(IsNull([dueDate]),IIf(IsNull([soonestPillar]),IIf(IsNull([gateLastPillar]),[gatePlannedDate],[gateLastPillar]),[soonestPillar]),[duedate]) AS due, tblPartTeam.person
FROM (sqryCountOfAttachments RIGHT JOIN (sqryPartProjectTags INNER JOIN (tblPartGates INNER JOIN ((((tblPartTrackingApprovals INNER JOIN tblPartSteps ON tblPartTrackingApprovals.tableRecordId = tblPartSteps.recordId) LEFT JOIN tblPartInfo ON tblPartSteps.partNumber = tblPartInfo.partNumber) INNER JOIN tblPermissions ON (tblPartTrackingApprovals.dept = tblPermissions.Dept) AND (tblPartTrackingApprovals.reqLevel = tblPermissions.Level)) INNER JOIN tblPartTeam ON tblPartSteps.partNumber = tblPartTeam.partNumber) ON tblPartGates.recordId = tblPartSteps.partGateId) ON sqryPartProjectTags.recordId = tblPartSteps.partProjectId) ON sqryCountOfAttachments.partStepId = tblPartSteps.recordId) INNER JOIN qryFindNextPillar ON tblPartSteps.partGateId = qryFindNextPillar.partGateId
WHERE (((tblPartTeam.person)=[tblPermissions]![User]) AND ((tblPartTrackingApprovals.approvedOn) Is Null) AND ((sqryPartProjectTags.partProjectStatus)<>'On Hold') AND ((IIf(IsNull([tblPartSteps]![documentType]),True,[CountOfID]>0))=True) AND ((tblPartSteps.indexOrder)<=[qryFindNextPillar].[index]));

